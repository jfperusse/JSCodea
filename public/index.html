<!-- ¬© 2022 Jean-Fran√ßois P√©russe -->

<html>
    <head>
        <title>Codea Web Client</title>
        <meta charset="UTF-8">
        <script type="text/javascript">
            window.indexedDB;
         </script>        
        <script src="fengari-web.js" type="text/javascript"></script>
        <script src="jszip.min.js" type="text/javascript"></script>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <script src="https://unpkg.com/jquery.terminal@2.x.x/js/jquery.terminal.min.js"></script>
        <style>
            @keyframes robotAnim {
                from { background-position: 0px; }
                to { background-position: -32px; }
            }

            .robot {
                height:16px;
                width:16px;
                background:url('Robot_v1.png');
                vertical-align:top;
                display:inline-block;
                animation-name: robotAnim; 
                animation-duration: 1.0s;
                animation-timing-function: steps(2);
                animation-iteration-count: infinite;
            }
        </style>
        <template id="greetings">
   __  ____   ___  __  ____  ____   __  
 _(  )/ ___) / __)/  \(    \(  __) / _\ 
/ \) \\___ \( (__(  O )) D ( ) _) /    \
\____/(____/ \___)\__/(____/(____)\_/\_/
        </template>
        <template id="initialPrompt">
Type '[[b;green;]help]' for a list of commands.
        </template>
        <template id="help">
[[b;green;]help]: show this messages
[[b;green;]changelog]: show the latest updates
[[b;green;]manual]: show the user manual
[[b;green;]roadmap]: show the backlog and in-progress tasks
[[b;green;]cheats]: show useful cheats for creating levels

Other commands are interpreted by Lua.
        </template>
        <template id="manual">
[[b;green;]Goal]
‚Ä¢ Get the robot to the end of the level ([[@;;;;Crystal.png]]).

[[i;green;]Not so lost] [[b;green;]Controls]
‚Ä¢ [[b;orange;]Enter, Space]: Skip text
‚Ä¢ [[b;orange;]Arrow Keys, WASD]: Move around
‚Ä¢ [[b;orange;]1-3]: Drop module
‚Ä¢ [[b;orange;]4-6]: Take module
‚Ä¢ [[b;orange;]R]: Restart level
‚Ä¢ [[b;orange;]Backspace]: Undo last move
        </template>
        <template id="cheats">
[[b;green;]Cheats]
‚Ä¢ [[b;orange;]giveInventory(item)]: Give an inventory item

[[i;yellow;]Type 'cheats' followed by the cheat name for more info.]
        </template>
        <template id="cheats giveInventory">
[[b;green;]giveInventory(item)]
‚Ä¢ item
  ‚Ä¢ [[b;orange;]"N"]: North Module
  ‚Ä¢ [[b;orange;]"S"]: South Module
  ‚Ä¢ [[b;orange;]"E"]: East Module
  ‚Ä¢ [[b;orange;]"W"]: West Module
  ‚Ä¢ [[b;orange;]"H"]: Horizontal Module
  ‚Ä¢ [[b;orange;]"V"]: Vertical Module
  ‚Ä¢ [[b;orange;]"X"]: Explosion
  ‚Ä¢ [[b;orange;]"I"]: Implosion
  ‚Ä¢ [[b;orange;]"p"]: Portable Portal
        </template>
        <template id="changelog">
[[b;green;]August 8th, 2022]
‚Ä¢ Added WASD support
‚Ä¢ Fixed levels Grenadier and Frogger
‚Ä¢ Added Previous and Next Level buttons in the editor
‚Ä¢ Added level name in the editor
‚Ä¢ Fixed issue with the boxes color
‚Ä¢ French localization tweaks
‚Ä¢ Added a surver after each level
‚Ä¢ Added Release Notes üòÖ

[[b;green;]August 11th, 2022]
‚Ä¢ Major UI changes to display the full level
‚Ä¢ Added full keyboard support for JSCodea
‚Ä¢ Fixed some issues with emojis (‚¨ÜÔ∏è‚¨ÜÔ∏è‚¨áÔ∏è‚¨áÔ∏è‚¨ÖÔ∏è‚û°Ô∏è‚¨ÖÔ∏è‚û°Ô∏è)

[[b;green;]August 19th, 2022]
‚Ä¢ Updated survey to use Google Forms
‚Ä¢ Added a Discord widget because, why not
‚Ä¢ Fixed an issue with blood and water (thanks Tony!)
‚Ä¢ Easier access to the level editor
‚Ä¢ Added ability to share new levels
‚Ä¢ Fixed level visibility issue when cheating
‚Ä¢ Fixed localization issue with level 2

[[b;green;]August 20th, 2022]
‚Ä¢ New feature: portable portals
‚Ä¢ New feature: horizontal/vertical modules
‚Ä¢ [[!;;;;?levelToLoad=51]Two new levels] with the new features
‚Ä¢ Disabled warping through walls and closed doors
    ‚Ä¢ I feel like it is easier to see this as a "jump"

[[b;green;]August 29th, 2022]
‚Ä¢ The long awaited sprites are in! [[@;;;;Robot_v1.png]]
‚Ä¢ The canvas now uses the full height.
‚Ä¢ (so you can see all the details in the pixels)
‚Ä¢ Updated the survey to be an annoying pop-up. Sorry!

[[b;green;]August 30th, 2022]
‚Ä¢ Save the volume value.
‚Ä¢ Lower default volume value (10% instead of 25%).
‚Ä¢ Load the game automatically.
‚Ä¢ Add a "Tap to Start" screen.
‚Ä¢ Better Discord integration on the web page.

[[b;green;]August 31st, 2022]
‚Ä¢ Clamp the DeltaTime to a maximum of 1 second (like Codea).
‚Ä¢ Dynamically resize Discord to always fit beside the game.
‚Ä¢ Add a Terminal to view print messages and enter commands.
‚Ä¢ New tutorial for the first level with the jump.
‚Ä¢ New levels [[!;;;;?levelToLoad=53]Mine Field 2] and [[!;;;;?levelToLoad=54]Mine Field 3]

[[b;green;]September 1st, 2022]
‚Ä¢ Prevent warping inside a box.
‚Ä¢ Fixed missing items when editing from the first levels.
‚Ä¢ Added fans (can jump over, blocks blood). See [[!;;;;?levelToLoad=46]Placement].
‚Ä¢ Brought back a [[!;;;;?levelToLoad=54]level] that was using warp.
‚Ä¢ Catch errors in setup() and draw() to display them here.
‚Ä¢ Added a checkbox to disable the survey.
‚Ä¢ Added a level variation [[!;;;;?levelToLoad=55]Portable 2].
‚Ä¢ Hide the diamond when the level is complete.
‚Ä¢ Don't allow testing invalid levels.

[[b;green;]September 2nd, 2022]
‚Ä¢ Added undo support.
‚Ä¢ Moved manual and changelog to Terminal commands.
‚Ä¢ Updated the page's background and text colors.
‚Ä¢ Restart is now on 'R' instead of 'Escape'.
‚Ä¢ Latest changelog is now in the Terminal greeting.
‚Ä¢ Added a fullscreen mode for supported browsers.
‚Ä¢ Improved support for vertical aspect ratio.
‚Ä¢ Fixed some bugs.

[[b;green;]September 3rd, 2022]
‚Ä¢ Fixed a bug with undo and portable portals.
‚Ä¢ Add a button to paste a level in the editor.
‚Ä¢ Added ability to share levels from iOS.

[[b;green;]September 4th, 2022]
‚Ä¢ Optimized and always enabled level preview.
‚Ä¢ Simplified the level mapping for walls.
‚Ä¢ Added some missing mappings for holes.

[[b;green;]September 5th, 2022]
‚Ä¢ Fully sprite based level editor.
  ‚Ä¢ Goodbye ascii art!
‚Ä¢ Levels can now have an author.
  ‚Ä¢ Added a [[!;;;;?levelToLoad=11]level by Am√©lie P].
‚Ä¢ Added a new 'cheats' command.
        </template>
        <template id="latestChangelog">
[[b;green;]September 7th, 2022]
‚Ä¢ Updated lasers to send blood as far as possible.
‚Ä¢ Increased maximum undo from 100 to 500.
‚Ä¢ Added a new "eraser" sprite for the level editor.
‚Ä¢ Added levels [[!;;;;?levelToLoad=57]Left Behind] and [[!;;;;?levelToLoad=57]Red Velvet].
‚Ä¢ Bug fixes.
        </template>

        <link rel="stylesheet" href="https://unpkg.com/jquery.terminal@2.x.x/css/jquery.terminal.min.css"/>
        <style>
            @font-face {
                font-family: AcademyEngravedLetPlain;
                src: local("Academy Engraved LET Plain"),
                    local("AcademyEngravedLetPlain"),
                    url(Fonts/AcademyEngravedLetPlain.ttf);
            }
            @font-face {
                font-family: AmericanTypewriter-Bold;
                src: local("American Typewriter Bold"),
                    local("AmericanTypewriter-Bold"),
                    url(Fonts/AmericanTypewriter-Bold.ttf);
            }
            @font-face {
                font-family: Baskerville-SemiBoldItalic;
                src: local("Baskerville SemiBold Italic"),
                    local("Baskerville-SemiBoldItalic"),
                    url(Fonts/Baskerville-SemiBoldItalic.ttf);
            }
            @font-face {
                font-family: Copperplate;
                src: local("Copperplate Regular"),
                    local("Copperplate"),
                    url(Fonts/Copperplate.ttf);
            }
            @font-face {
                font-family: SourceSansPro-Bold;
                src: local("Source Sans Pro Bold"),
                    local("SourceSansPro-Bold"),
                    url(Fonts/SourceSansPro-Bold.ttf);
            }
            @font-face {
                font-family: AppleColorEmoji;
                src: local("AppleColorEmoji"),
                    local("Apple Color Emoji"),
                    url(Fonts/NotoColorEmoji.ttf);
            }
            body {
                color: white;
                background-color: #282831;
            }
        </style>
        <link rel="preload" as="font" href="/Fonts/AcademyEngravedLetPlain.ttf" type="font/ttf" crossorigin="anonymous">
        <link rel="preload" as="font" href="/Fonts/AmericanTypewriter-Bold.ttf" type="font/ttf" crossorigin="anonymous">
        <link rel="preload" as="font" href="/Fonts/Baskerville-SemiBoldItalic.ttf" type="font/ttf" crossorigin="anonymous">
        <link rel="preload" as="font" href="/Fonts/Copperplate.ttf" type="font/ttf" crossorigin="anonymous">
        <link rel="preload" as="font" href="/Fonts/SourceSansPro-Bold.ttf" type="font/ttf" crossorigin="anonymous">
        <link rel="preload" as="font" href="/Fonts/NotoColorEmoji.ttf" type="font/ttf" crossorigin="anonymous">
    </head>
    <body>
        <script>
            function levelEnd(index, name) {
                var enableSurveyElement = document.getElementById("enableSurvey");
                if (enableSurveyElement.checked) {
                    surveyFrame = document.getElementById("survey-frame");
                    surveyFrame.src = "https://docs.google.com/forms/d/e/1FAIpQLScq8cHsg_TrVtO3g2NtNVqjMDz9cJi0sMokUimCC2zSxBLkjA/viewform?embedded=true&entry.449887126=" + encodeURIComponent(name);
                    surveyContainer.style.display = "block";
                }
            }

            function closeSurvey() {
                surveyContainer.style.display = "none";
            }

            function getParameters() {
                return Object.fromEntries(new URLSearchParams(location.search));
            }

            function shareLevel(data) {
                window.open('mailto:jfperusse+lostcontrols@gmail.com?subject=Lost Controls Level&body=' + encodeURIComponent(data), 'mail');
            }
        </script>
        <style>
            .survey-container {
                display: none; /* Hidden by default */
                position: fixed; /* Stay in place */
                z-index: 1; /* Sit on top */
                padding-top: 20px; /* Location of the box */
                left: 0;
                top: 0;
                width: 100%; /* Full width */
                height: 100%; /* Full height */
                overflow: auto; /* Enable scroll if needed */
                background-color: rgb(0,0,0); /* Fallback color */
                background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            }
            .survey-content {
                position: relative;
                background-color: #fefefe;
                margin: auto;
                margin-right: 20px;
                padding: 0;
                border: 1px solid #888;
                width: 50%;
                box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
                -webkit-animation-name: animatetop;
                -webkit-animation-duration: 0.4s;
                animation-name: animatetop;
                animation-duration: 0.4s
            }
            .close {
                color: #aaa;
                float: right;
                font-size: 28px;
                font-weight: bold;
            }
            .close:hover,
            .close:focus {
                color: black;
                text-decoration: none;
                cursor: pointer;
            }            
            @-webkit-keyframes animatetop {
                from {top:-300px; opacity:0} 
                to {top:0; opacity:1}
            }
            @keyframes animatetop {
                from {top:-300px; opacity:0}
                to {top:0; opacity:1}
            }
        </style>
        <div id="survey-container" class="survey-container">
            <div class="survey-content">
                <span class="close" onclick="closeSurvey()">&times;&nbsp;</span>
                <iframe id="survey-frame" src="" width="100%" height="600" frameborder="0" marginheight="0" marginwidth="0">Loading‚Ä¶</iframe><br><br>    
            </div>
        </div>
        Volume: <input type="range" id="volume" min="0" max="1" value="0.05" step="0.01"><span id="volumeValue">0 %</span>
        <script>
            var volumeElement = document.getElementById("volume");
            var startVolume = localStorage.getItem('volume') || '0.05';
            volumeElement.value = startVolume;
        </script>
        <input type="checkbox" id="enableSurvey" checked="false">Enable Survey
        <script>
            var enableSurveyElement = document.getElementById("enableSurvey");
            var startEnabled = localStorage.getItem('enableSurvey') == 1;
            enableSurveyElement.checked = startEnabled;
            enableSurveyElement.onclick = function() {
                localStorage.setItem('enableSurvey', enableSurveyElement.checked ? 1 : 0);
            };
        </script>
        <style>
            .button {
                background-color: #008CBA;
                border-radius: 4px;
                border: none;
                color: white;
                padding: 2px 4px;
                text-align: center;
                text-decoration: none;
                display: inline-block;
                font-size: 12px;
                margin: 0px 38px;
                cursor: pointer;
            }
        </style>
        <span style="display:inline-block;position:absolute;right:0;"><button class="button" id="fullscreenButton" onclick="goFullscreen()">Go Fullscreen</button></span>
        <br>
        <canvas style="width:800px;height:600px;" width="1024px" height="768px" id="myCanvas">Canvas is not supported on your browser.</canvas>
        <span style="vertical-align:top;display:inline-block;">
            <widgetbot id="widgetbot" server="1010304551263416400" channel="1010304551817068576" width="500" height="45%"></widgetbot>
            <script src="https://cdn.jsdelivr.net/npm/@widgetbot/html-embed"></script>
            <br id="widgetBreak">
            <div id="terminal" style="vertical-align:top;display:inline-block;"></div>
        </span>
        <script>
            if (false) {
                setTimeout(function() {
                    levelEnd(1, "ThisIsATest");
                }, 1000);
            }
        </script>

        <!-- <input type="file" id="codeaProjects" name="codeaProjects" accept=".zip"> -->

        <script type="application/lua" src="core.lua?version=1"></script>
        <script type="application/lua" src="class.lua?version=1"></script>
        <script type="application/lua" src="color.lua?version=1"></script>
        <script type="application/lua" src="vec2.lua?version=1"></script>
        <script type="application/lua" src="js_runtime.lua?version=14"></script>

        <script src="https://sfxr.me/riffwave.js"></script>
        <script src="https://sfxr.me/sfxr.js"></script>
        <script src="loader.js?version=1"></script>
        <script src="runtime.js?version=22"></script>
    </body>
</html>